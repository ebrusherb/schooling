\documentclass{article}
%\documentclass[aps, twocolumn, tightenlines,amscd,amsmath,amssymb,verbatim]{revtex4}
\usepackage{latexsym}
\usepackage{amssymb,amsmath}
\usepackage{custom2}
\usepackage{graphicx} % for figures
\usepackage{epstopdf} % so can use EPS or PDF figures
%\usepackage{subfig}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{url}
\usepackage{amssymb,amsfonts}
\usepackage[all,arc]{xy}
\usepackage{enumerate}
\usepackage{mathrsfs}
\usepackage{booktabs}
\usepackage[pdftex]{hyperref}
\usepackage{lscape}
\captionsetup{justification=RaggedRight, singlelinecheck=false}
\newcommand{\ra}[1]{\renewcommand{\arraystretch}{#1}}
\newcommand{\argmax}{\text{argmax}}
\newcommand{\Tr}{\text{Tr}}
\newcommand{\z}{\mathscr{Z}}
%\newtheorem{claim}{Claim}

\addtolength{\evensidemargin}{-.5in}
\addtolength{\oddsidemargin}{-.5in}
\addtolength{\textwidth}{1.4in}
\addtolength{\textheight}{1.4in}
\addtolength{\topmargin}{-.5in}

\pagestyle{empty}

\begin{document}

%
%\begin{center}
%{\bf \LARGE{Evolution of Information Gathering Strategies}}
%\vspace{10pt}
%\\ Eleanor Brush
%\\ October 31, 2014
%\end{center}

\tableofcontents

\section{Abstract}
Birds in flocks, like animals in many types of social groups, can use their peers to learn about the environment and update their opinions about where to move in that environment.  Previous work on starlings has measured the number of other birds an individuals pays attention to and shown that this number of ``neighbors" leads to a social network that is conducive to the whole flock reaching consensus.  It is unclear, however, why an individual would change its behavior, i.e. the number of neighbors it learns from, to achieve this outcome.  Individual birds should optimize how well they learn about the environment. There are (at least) two features of the environment that are important to an individual bird's fitness---the location of a predator and the location of resources---and it can try to learn about these from its peers. In this work, we identify the optimal strategies for birds under selection pressure dictated by these types of information and explore the relationship between the robustness measure and the correlation length of the flock, a measure commonly used to describe how close a flock's structure is to criticality.

\section{Introduction }
%Introduction to schools and flocks
%
%Reasons for flocking / paying attention to your peers. Predation \cite{Ballerini:2007uq} Empirical evidence for reduced predator efficiency when the prey are a in a bigger group (captive fish) \cite{Landeau:1986fk}. Foraging (find citations). Foraging (cite bat / information center papers). I have to make some statement to the effect that I assume predator efficiency is constant irrespective of the type of network the flock forms or if it's even connected.  Which is conservative.
%
%How to construct a social network: Zone model a la Couzin uses metric interaction rules. Metric zones seem to reproduce flocking dynamics in surf scoters \cite{Lukeman:2010vn}.  Evidence for topological network in starlings \cite{Ballerini:2007uq}, which they suggest must rely on vision \cite{Ballerini:2007uq}, although this can produced by a model in which an interaction range is governed by absolute distance instead of number of neighbors \cite{Bode:2010ys}. Evidence that the ability to see one's neighbors should be included in constructing social networks (golden shiners) \cite{Strandburg-Peshkin:2013fk}
%
%evidence for six to seven neighbors from anisotropy of positions of neighbors \cite{Ballerini:2007uq}  Ballerini argues that six / seven represents a cognitive limitation \cite{Ballerini:2007uq}. maximum likelihood interaction range is around ten \cite{Bialek:2012fk}
%
%assertion that individuals are trying to maintain a cohesive group "The main goal of the interaction among individuals is to maintain cohesion of the group. This cohesion is a very strong biological requirement, shaped by the evolutionary pressure for survival: Stragglers and small groups are significantly more prone to predation than animals belonging to large and highly cohesive aggregations." \cite{Ballerini:2007uq}, the support for which comes from a paper about teleost fishes. But why should the group maintain cohesion due to a predator response if predation is the thing causing cohesion? There's something circular here. And "An alternative interpretation of the interaction range we find is that the specific value of $n_\text{c}$ may be functional to optimize anti predatory response: If each individual interacts with too few neighbors, information is non noisy, but it is too short-ranged; conversely, if the interaction involves too many neighbors, information is averaged over several ill-informed individuals, and it is too noisy" \cite{Ballerini:2007uq} --- BUT WE FIND THE OPPOSITE. "The interaction mechanism shaped by evolution must keep cohesion in the face of strong perturbations, of which predation is the most relevant. We believe that topological interaction is the only mechanisms granting such robust cohesion and, therefore, higher biological fitness." \cite{Ballerini:2007uq} 
%
%Evidence for how collective create interesting structures \cite{Cavagna:2009kx} \cite{Bialek:2013fk} \cite{Young:2013kx}
%
%Individual evolution, consequences for group structure\cite{Torney:2015fk}
%
%NOTE: A similar model of random flock dynamics is in \cite{Shang:2014uq}. They randomly place nodes in a unit square repeatedly, but they let them keep their opinions across spatial shuffles. They prove that the system exponentially approaches consensus in the absence of noise and show that the system almost always reaches consensus in the presence of noise \cite{Shang:2014uq}. With or without noise, the time to consensus decreases as the number of neighbors increases, but with diminishing returns, as in \cite{Young:2013kx}.
%
%Can individual optimization reproduce interesting group structure?
%
%CRITICALITY AS AN INFORMATIONAL TRAGEDY OF THE COMMONS.
%
%Two points to make about optimization in a group: 1) \cite{Torney:2015fk} found that when one individual changes its strategy it does not change the overall social environment and thus can optimize without regard for the group. However, to find the group-level optimum, one must change the group's strategy and thus the social environment, leading to an group optimum different from the individual's. Same here. 2) The existence of multiple ESS is evidence for how important social environment is because what is an un-invadable strategy when it is at high frequency does poorly when another strategy is at high frequency.
%
Questions:
\begin{enumerate}
\item How are the two group properties---$\mathscr{H}_2$ robustness and correlation length---related?
\item What are the equilibrium strategies of individuals seeking to optimize their own fitness?
\item What group properties emerge from individual-level optimization?
\end{enumerate}


\section{Model }

\subsection{Modeling interactions and group-level properties }
There are two ways to describe equilibrium properties of a flock sharing information over a network.  The first is to write down a set of differential equations with noise to describe how each bird's opinion changes over time and then to analyze the distribution of these opinions after the dynamics have reached equilibrium \cite{Young:2010fk,Young:2013kx}. The second is to write down an explicitly probability distribution of the opinions at equilibrium and to analyze this distribution. WIth either approach, we consider a vector of opinions $v$ where $v_i$ a a scalar that represents the $i^\text{th}$'s bird opinion about an unspecified behavior, for example where or how fast to fly. Both approaches rely on a network of connections between the birds, which we will describe first. Let $A$ be the adjacency matrix such that 

\begin{equation}
A_{ij}=\left\{\begin{array}{l l l}
1 & \text{ if $i$ pays attention to $j$ }
\\0 & \text{ otherwise }
\end{array}\right.
\end{equation}
If $k_i$ is the number of neighbors node $i$ has, then $k_i=\sum_kA_{ik}$. We assume that having more neighbors means paying less attention to each so we normalize $A$ to find $\bar{A}$: $\bar{A}_{ij}=\frac{A_{ij}}{k_i}$.


The Laplacian of this matrix is given by $L=\bar{A}-I$, which is symmetric only if $A$ is.  We can symmetrize the interactions by defining $S=\frac{1}{2}(A+A^T)$ and $P$ such that $P_{ij}=S_{ij}$ for $j\neq i$ and $P_{ii}=-\sum_kS_{ik}$. Then $L$ and $P$ share the properties that $L\vec{1}=P\vec{1}=\vec{0}$ and that each is negative semi-definite, with the difference being that $P$ is necessarily symmetric.  It is more common to use $L$ in a dynamics system approach, so that 
\begin{equation}
\dot{v}_i=\frac{1}{k_i}\sum_i\left(v_j-v_i\right)+\sqrt{k_i}\xi_i
\end{equation}
\begin{equation}
\dot{v}=Lv+D\xi \label{opinion_dynamics}
\end{equation} 
where $D$ is a diagonal matrix with entires $\{\sqrt{k_i}\}$ and $E[\xi(t)]=\vec{0}$, $E[\xi(t)\xi(s)^T]=\frac{1}{2}\delta(t-s)I$, and $E[v(0)\xi(t)^T]=\vec{0}$. This describes a system in which each bird changes averages the differences between its own opinions and those of its neighbors and changes its opinion to minimize these differences. Our choice of $D$ assumes that birds with more neighbors make noisier estimates of how to change their opinions. 

The Boltzmann distribution in statistical physics is a standard way in which to write an equilibrium distribution. In physics, those states with the highest energy are least likely. In our system, those sets of opinions that are least in consensus will be less likely. Specifically, we will use the following expression to represent the ``energy'' of an opinion vector
\begin{equation}
H(v)=-v^TPv \label{Hamiltonian}
\end{equation}
and the Boltzmann distribution
\begin{equation}
P(v)=\frac{1}{Z}\exp\left(-\frac{1}{2}H(v)\right) \label{Boltzmann}
\end{equation}
where $Z=\int_\R^N\exp\left(-\frac{1}{2}H(v)\right)dv$.

With the dynamical approach, in the absence of noise, the system would reach consensus with each $v_i=\alpha$ for some $\alpha\in\R$. Similarly, with the statistical physics approach, consensus states with each $v_i=\alpha$ are most likely. However, all consensus values $\alpha$ are equally likely. It is therefore difficult to describe correlations between the bird's opinions at equilibrium. It becomes easier, however, to consider deviations from consensus. If all $v_i$ are equal, then $v=\alpha\vec{1}$. To consider deviations from this consensus state, it is useful to define a matrix $Q\in\R^{N-1}\times\R^N$ such that each row of $Q$ is orthogonal to $\vec{1}$ and the rows are pairwise orthogonal. Young et al. show in \cite{Young:2010fk,Young:2013kx} that this is equivalent to a $Q$ such that $QQ^T=I_{N-1}$ and $Q^TQ=I_N-\frac{1}{N}\vec{1}\vec{1}^T$. To simply consider absolute deviations from the average opinion of the flock, we can define $z=v-\langle v\rangle \vec{1}=Q^TQv$, where $\langle v \rangle =\frac{v_i}{N}$. To consider the component of the opinion vector that is orthogonal to consensus, we can define $y=Qv=Qz$. Let $\Sigma_z=\lim_{t\to\infty}E[zz^T]$ and $\Sigma_y=\lim_{t\to\infty}E[yy^T]$ using the dynamical approach and $C_z=E[zz^T]$ and $C_y=E[yy^T]$ using the statistical physics approach. Since $y=Qz$ and $z=Q^Ty$, in either case, we can translate easily between $\Sigma_z$ and $\Sigma_y$ or between $C_z$ and $C_y$. In the Appendix, we derive equations for each of these covariance matrices and summarize the expression for the $y$ covariance matrices in Table \ref{correspondence}.  The first thing to note is that, if instead of using $L$ we use $P$ in the dynamical approach and all birds have the same number of neighbors, then $C_y=2\Sigma_y$, as shown in Claim \ref{cov_equivalence}. There is therefore a close correspondence between the two approaches.

These covariance matrices allow us to define two group properties. The first is $\mathscr{H}_2$ robustness, as used in \cite{Young:2010fk,Young:2013kx}. This is a measure of the robustness of the consensus state in which all birds have the same opinion to noise at equilibrium. Specifically, 
\begin{equation}
\rho=\frac{1}{\lim_{t\to\infty}E[||y||]}=\frac{1}{\lim_{t\to\infty}\Tr(\Sigma_y)}. \label{H2def}
\end{equation}
The second property is the correlation length of the flock. This is the distance over which birds' opinions tend to be positively correlated with each other. If we know the distances between the birds and the covariance matrix $C_z$, we can plot the correlations $\{E[z_iz_j]\}$ between each pair of birds' deviations from consensus against the distance between the birds and then identify the correlation length $\lambda$ by finding the distance at which these correlations become $0$.

So far, we have considered birds whose opinions only depend on the opinions of the rest of the flock. We can additionally incorporate environmental information by assuming that there is an environmental signal such that more informed birds have opinions closer to $1$. If we let $B$ be a matrix with $B_ii=1$ if $i$ can perceive the signal and $0$ otherwise, then the dynamical system becomes
\begin{equation}
\dot{v}=Lv+B(\vec{1}-v)+D\xi =L_\text{s}v+B\vec{1}+D\xi \label{opinion_dynamics2}
\end{equation}
where $L_\text{s}=L-B$. Similarly, the statistical physics model becomes
\begin{equation}
P(v)=\frac{1}{Z}\exp\left(-\frac{1}{2}(v-\vec{1})^T(-P+B)(v-\vec{1})\right)=\frac{1}{Z}\exp\left(\frac{1}{2}(v-\vec{1})^T(-P_\text{s})(v-\vec{1})\right)
\end{equation}
where $P_\text{s}=P-B$. Again, we can find the covariance matrices $\Sigma_z$, $\Sigma_y$, $C_z$, and $C_y$. As was the case without a signal, if we use $P$ in the dynamical approach and all birds have the same number of neighbors, then we find that $C_y=2\Sigma_y$ (Claim \ref{cov_equivalence}). We define $\rho$ and $\lambda$ as above using the matrices $\Sigma_y$ and $C_z$ in the presence of a signal.


\subsection{Individual-level fitness }
To find the optimal strategies from the individuals' perspectives, we need a measure of individual-level fitness. We use the dynamical system to describe how well each bird learns about the environmental signal. For a given matrix $L$, the expected opinion $q_i$ of each individual satisfies the equations
\begin{equation}
\dot{q}=L_\text{s}q+B\vec{1}. \label{expected_opinion}
\end{equation}
To generate a matrix $L$, we distribute the individuals randomly in space (specifically, in a unit square). has a strategy $k_i$ that dictates how many neighbors it has, so that $k_i=\sum_{j\neq i}{\bf I}(A_{ij}\neq 0)$.    Each individual then pays attention to its $k_i$ nearest neighbors.  One individual is chosen to be a receiver; it and all those individuals within a radius $r$ of the receiver perceive, so that $B_{ii}=1$ for all those birds within this radius. We do this $1000$ times and find $q(1)$ for each matrix, which we refer to as a signaling event. This is meant to simulate a situation in which such that information is present only intermittently and otherwise the birds are moving randomly through space and restructuring their network.  If, instead of paying attention to the closest neighbors, a bird choose $k_i$ neighbors at random out of $N$ birds, $N_\text{I}$ of whom are informed, the number of informed neighbors follows a hypergeometric distribution:
\begin{equation}
P(j \text{ informed neighbors} )=\frac{{N_\text{I}\choose j}{N-N_\text{I}\choose k_i-j}  }{{N\choose k_i}}. \label{hypergeom}
\end{equation} 
This distribution is not an exact description of the probability of $j$ informed neighbors in our model  since it ignores spatial proximity, but it is a useful approximation for considering the advantages and disadvantages of each strategy $k_i$.


We consider signals that provide information about two types of content: predators and food.  If the signal is information that a predator is present, we assume that whichever individual is least aware of the signal will be predated, i.e. the individual $i$ such that $q_i$ is lowest. Then, fitness is proportional to the probability of surviving, i.e. $1$ minus the probability of being the least informed over many signaling events. If the signal is information that resources are available, we consider two levels of resource abundance. If there are scarce resources, we assume that whichever individual is most aware of the signal will get access to the resource, i.e. the individual $i$ such that $q_i$ is highest. In this case, fitness is proportional to the probability of getting the resource, i.e. the probability of being the most informed over many signaling events. If there are abundant resources, we assume that the first four individuals to the resources can share it, so that fitness is proportional to the probability of being one of the four most informed birds. Finally, we consider a combination of predation and resources: fitness is proportional to the $1$ minus the probability of being predated times the probability of being the most informed. The behavior that the birds can change to improve their fitness is the number of other birds they pay attention to, $k_i$. In particular, each individual has a strategy $k_i$ that dictates how many neighbors it has, so that $k_i=\sum_{j\neq i}{\bf I}(A_{ij}\neq 0)$.    

\subsection{Optimization methods }
To understand what strategies we might expect to find, we are interested in identifying the optimal strategies.  We does this in two ways.  First, using the framework of adaptive dynamics in finite populations, we identify the evolutionarily stable strategy.  This framework assumes that there is a homogeneous population into which a mutant individual tries to invade.  If strategies change on a learning rather than an evolutionary timescale, or if there is just a lot of variation in the population, we might expect individuals to try to optimize their strategies in the context of a heterogeneous population.  This is our second method of optimization. Given a random set of initial strategies over the group, we allow each bird to choose the strategy that would be best given the rest of the strategies being used and repeat this process until the birds reach an equilibrium set of strategies. We repeat this over many initial sets of strategies to find average properties of this optimization process.

\section{Results }

\subsection{Robustness and correlation length are positively related. }
In a homogeneous flock, where every bird is using the same strategy, as both the strategy and the radius of the signal change, both $\mathscr{H}_2$ and the correlation length are affected.  Figure \ref{compare_props} shows that both $\mathscr{H}_2$ and correlation length are maximized at intermediate strategies when the radius is low and at low strategies when the radius is high. We prove in the Appendix (Appendix Claim \ref{cov_equivalence}) that if we use a symmetric matrix to calculate $\rho$ and all birds have the same number of neighbors $n$, then the covariance matrices used to calculate $\rho$ and $\lambda$ are identical up to a constant, which suggests that the two properties cannot be optimized independently.

\subsection{There are multiple ESS, which depend on the content of the signal. }
Surprisingly, even without imposing costs on paying attention to more neighbors, paying attention to the whole flock is not always the best strategy. The ESS strategy of the number of neighbors to pay attention strongly depends on which selection pressure is being applied.  

Those birds that can perceive the environmental signal will always have better information than those that cannot. Selection, therefore, acts to improve a bird's ability to learn about the signal when it cannot perceive it.  In Appendix Claim \ref{exp_approx} we show that an uninformed bird's opinion can be approximated by $\sum_{\text{informed }j}L_{ij}$, that is the total weight given to informed birds.  Being the most well-informed uninformed bird, therefore, amounts to having the highest proportion of informed neighbors and being the least well-informed amounts to having the smallest proportion of informed neighbors. As described above, the hypergeometric distribution is a good approximation for the probability distribution of the number of informed neighbors a bird with strategy $k_i$ will have. As shown in Figure \ref{hypergeo}, under the hypergeometric distribution, having many neighbors makes it unlikely that few of those neighbors will be uninformed, but it also makes it unlikely that all of them will be uninformed (Figure \ref{hypergeo}).  

These observations explain the ESS number of neighbors we find.

If a focal bird pays attention to many others, its opinion will be similar to theirs. This will prevent it from being the most informed and hence the first to locate resources. Thus, the uninvadable strategy is to pay attention to few neighbors when selection is due to knowledge about resources. On the other hand, having many neighbors will prevent the focal bird from being the least informed and thus the most likely to be eaten.  Thus, the uninvadable strategy is to pay attention to many neighbors when selection is due to knowledge about predators. Figure \ref{ESS}a shows the ESS strategy when selection is due to knowledge about resources is always lower than the ESS strategy when selection is due to knowledge about predators (Figure \ref{ESS}a).
%%a different explanation: Having many neighbors means that your opinion will be close to the average opinion of the group. Even if some of your many neighbors or informed, others will not be, and your opinion will be somewhere in between. If you have few neighbors, on the other hand, your opinion will often be at the extremes of the group: low, if you have few informed neighbors, and high, if you have many informed neighbors. To avoid being in the bottom of the group, therefore, you should avoid having few neighbors. To try to be in the top, on the other hand, having few neighbors is a good strategy. I think maybe this a more intuitive way to say it?

The ESS strategies when selection is due to knowledge about predators show two interesting features. First, there are many parameters for which there are multiple ESS strategies. It might seem that if a strategy outperforms all others when it is the resident strategy, it should also outperform other strategies as an invader. However, when there are multiple ESS strategies, if we take any two of those ESS strategies, each is uninvadable by the other. This indicates how important the social environment set by the resident strategy is. The pairwise invisibility plot in Figure \ref{ESS}b shows that low strategies are always costly and that high strategies are only costly when the resident strategy is high. 

If a bird has the environmental signal, it will not be predated, regardless of the number of neighbors it has. The differences in performance only appear when comparing two birds, neither of whom have the signal. To understand the costs of having too few or too many neighbors, we compare the performance of two focal birds, a resident and an invader, neither of whom has the signal.  There are two main cases: there can be a single informed bird or multiple informed birds. We further break down the first case depending on which of these two focal birds pays attention to the informed bird: neither, the resident, the invader, or both. For each of these cases, we find the probability that the invader is predated. An invader with one fewer neighbor than the resident always has probability of being predated greater than chance ($1/N$) because the resident often has an informed neighbor while the invader how no or fewer informed neighbors and thus a less informed opinion (Figure \ref{ESS}c). The total probability of being predated stays more or less constant regardless of the resident strategy, with a slight decrease for high resident strategies (Figure \ref{ESS}b and c). An invader with one more neighbor than the resident is only more likely than chance to be predated when the resident strategy is high enough  (Figure \ref{ESS}d). This invader performs most poorly when both it and the focal resident pay attention to the informed bird(s). In this case, an invader with one more neighbor has more naive neighbors and thus a less informed opinion. This is increasingly problematic as the resident strategy increases and both the focal birds are likely to pay attention to the informed bird(s).

\subsection{The predation ESS is to pay attention to more neighbors when the signal is more public.}
These opposing forces caused by the costs of not paying attention to informed neighbors  and the costs of paying attention to more uninformed neighbors  also explains the second feature of the ESS strategies: they are non-monotonic with respect to the the radius of the signal, i.e. how public the signal is (Figure \ref{ESS}a). Figure \ref{ESS}a shows that there are essentially three categories of radii: When the radius is low, the signal is private, with only a few birds having true information. When the radius is intermediate, the signal is public, with many birds having true information. When the radius is high, the signal is universal, with essentially all birds in the flock having true information. When the signal is private, paying attention to too few birds is costly because with more neighbors it is more likely to have a truly informed neighbor, but paying attention to too many uninformed birds can also be costly. This leads to a high but not maximal ESS strategy. When the signal is public, the costs of paying attention to uninformed birds are reduced and the ESS strategy increases to become as high as possible. When the signal is universal, not paying attention to informed birds does not impose a cost. Additionally, in a group in which the residents pay attention to all of their neighbors, any mutant strategy can get just as much information by paying attention to fewer neighbors so the maximal strategy is no longer an ESS (Figure \ref{ESS}a).

%Figure \ref{ESS_v_H2} shows how the ESS strategy changes as a function of the $\mathscr{H}_2$ robustness.

\subsection{Learned strategies }
The equilibrium strategies when the individuals are allowed to learn are similar to the ESS strategies: learned strategies when selection is due to predation are always higher than learned strategies when selection is due to resources (Figure \ref{greedyopt}). 
%Surprisingly, even when the group starts with heterogeneous strategies, they often reach a homogeneous equilibrium. Under selection due to predation, the $\mathscr{H}_2$ robustness and correlation length of the flock tend to decrease, whereas under selection due to resources, $\mathscr{H}_2$ robustness is relatively constant and correlation length tends to increase (Figure \ref{greedyopt}).


\section{Discussion}
explore vs. exploit 
risk aversion vs. risk tolerance

expect single ESS strategies but social information depends on the social environment set by the resident strategy
expect ESS strategies to decrease as the signal becomes more public, but we find the opposite

\newpage
\section{Appendix}

\subsection{Linear algebra claims and theorems }

\begin{claim} 
\label{exp_approx}
Suppose. $v(t)$ satisfies $\dot{v}=Av+f$ with $v(0)=v_0$, where $A$ has no $0$ eigenvalues. If $V$ is the matrix of eigenvectors of $A$ and $\Lambda$ is diagonal with the eigenvalues of $A$, then
\begin{equation} \label{diffeq_solution}
v(t)=V\exp(t\Lambda)V^{-1}v_0+V\Lambda^{-1}(\exp(t\Lambda)-I)V^{-1}f.
\end{equation}
We can approximate $v(t)\approx V\exp(t\Lambda)V^{-1}v_0+V(tI+\frac{t^2}{2}A)V^{-1}f$ if the eigenvalues are not too far from $0$. In the case that $A=L_\text{f}$ and $f=B\vec{1}$, this suggests that for $i$ that cannot perceive the signal, $v_i(t)\approx \frac{t^2}{2}\sum_{\text{informed }j }L_{ij}.$ This approximation is reasonable for $i$ such that $B_{ii}=0$, but worse for $i$ such that $B_{ii}\neq 0$. 
\end{claim}

\begin{pf}
First we show that (\ref{diffeq_solution}) solves the differential equation. Note that if $A=V\Lambda V^{-1}$.
\begin{align*}
\dot{v}&=V\Lambda \exp(t\Lambda)V^{-1}v_0+V\Lambda^{-1}(\Lambda\exp(t\Lambda))V^{-1}f
\\&=V\Lambda V^{-1}V\exp(t\Lambda)V^{-1}v_0+V\exp(t\Lambda)V^{-1}f
\\&=AV\exp(t\Lambda)V^{-1}v_0+V\exp(t\Lambda)V^{-1}f-VV^{-1}f+VV^{-1}f
\\&=AV\exp(t\Lambda)V^{-1}v_0+V(\exp(t\Lambda)-I)V^{-1}f+f
\\&=AV\exp(t\Lambda)V^{-1}v_0+V\Lambda V^{-1}V \Lambda^{-1}(\exp(t\Lambda)-I)V^{-1}f+f
\\&=AV\exp(t\Lambda)V^{-1}v_0+A\Lambda^{-1}(\exp(t\Lambda)-I)V^{-1}f+f
\\&=Av(t)+f.
\end{align*}
If $g(x)=\frac{1}{x}(\exp(ax)-1)$, then $g(x)\approx a+\frac{a^2}{2}x$ for $x$ close to $0$. Then, if the eigenvalues of $A$ are not too far from $0$, $\Lambda^{-1}(\exp(t\Lambda)-I)\approx  tI+\frac{t^2}{2}\Lambda$.  If $A=L_\text{f}$, then all eigenvalues of $A$ are negative.  If $N_\text{I}$ is the number of informed individuals, i.e. $i$ such that $B_{ii}\neq0$, then there are $N_\text{I}$ eigenvalues of $A$ close to $-2$ such that, if  $k$ is the index of one of these eigenvalues, $V_{ik}$ is large if and only if $i$ is informed.  The rest of the $N-N_\text{I}$ eigenvalues are between $-2$ and $0$ and, if $k$ is the index of one of these eigenvalues, $V_{ik}$ is large if and only if $i$ is uninformed. Therefore, the eigenvalue approximation is worst for the informed individuals and best for the uninformed individuals. Using the eigenvalue approximation, $v(t)$ becomes 
\begin{align*}
v(t)=V\exp(t\Lambda)V^{-1}v_0+tVV^{-1}B\vec{1}+\frac{t^2}{2}V\Lambda V^{-1}B\vec{1}=V\exp(t\Lambda)V^{-1}v_0+tB\vec{1}+\frac{t^2}{2}L_\text{f}B\vec{1}
\end{align*}
Ignoring the informed individuals and the initial conditions, this gives $v_i(t)\approx \sum_{\text{informed } j}L_{ij}$.
\end{pf}

\begin{theorem} \label{lyapeq_theorem}
Given any positive symmetric matrix $Q>0$ there exists a unique positive symmetric ] matrix $\Sigma>0$ satisfyying $A\Sigma+\Sigma A^T=Q$ if and only if the system $\dot{x}=Ax$ is globally asymptotically stable.
\end{theorem}
\begin{pf}
Proof available elsewhere.
\end{pf}

\begin{claim} \label{lyapeq_derivation}
Consider the dynamical system,
\begin{equation}
\dot{y}=Ay+v+Q\xi  \label{tofindsigma}
\end{equation}
with $E[\xi(t)]=0$, $E[\xi(t)\xi(s)^T]=\frac{1}{2}\delta(t-s)I$, and $E[y(0)\xi^T(t)]=0$. If all eigenvalues of $A$ are negative and if $\Sigma_t=E[y(t)y(t)^T]$ and $\Sigma=\lim_{t\to\infty}\Sigma_t$, then $\Sigma$ satisfies the Lyapunov equation
\begin{equation*}
A\Sigma+\Sigma A^T=A^{-1}vv^T+vv^T(A^{-1})^T-QQ^T.
\end{equation*}
Further, if $C_{ij}=\lim_{t\to\infty} E[(y_i(t)-E(y_i(t)))(y_j(t)-E(y_j(t)))]$ then 
\begin{equation*}
AC+CA^T=-QQ^T
\end{equation*}
\end{claim}

\begin{pf}
\begin{align*}
\Sigma_t&=E[y(t)y(t)^T]
\\ \Rightarrow \dot{\Sigma}&=E[\dot{y}(t)y(t)^T+y(t)\dot{y}(t)^T]
\\&=E[(Ay+v+Q\xi)y^T+y(y^TA^T+v^T+\xi^TQ^T)]
\\&=AE[yy^T]+E[yy^T]A^T+vE[y^T]+E[y]v^T+QE[\xi y^T]+E[y\xi^T]Q^T
\\&=A\Sigma_t+\Sigma_tA^T+vE[y^T]+E[y]v^T+QE[\xi y^T]+E[y\xi^T]Q^T.
\end{align*}
Note that we can write a solution to (\ref{tofindsigma}) as 
\begin{equation}
y(t)=\exp(At)y(0)+\int_0^t\exp(A(t-s))vds+\int_0^t\exp(A(t-s))Q\xi(s)ds. \label{sde_solution}
\end{equation}
Eq. (\ref{sde_solution}) allows us to write 
\begin{align*}
E[y(t)]&=\exp(At)y(0)+\int_0^t\exp(A(t-s))vds
\\&=\exp(At)y(0)-A^{-1}\exp(A(t-s))v|_{s=0}^{s=t} \text{ which exists because $A$ has no $0$ eigenvalues }
\\&=\exp(At)y(0)-A^{-1}(I-\exp(At))v.
\end{align*}
Note that if we take the limit as $t$ goes to infinity, 
$$\lim_{t\to\infty}E[(y(t))]=\lim_{t\to\infty}\exp(At)y(0)-A^{-1}(I-\exp(At))v=-A^{-1}v $$ 
since all eigenvalues of $A$ are negative.  Eq. (\ref{sde_solution}) also allows us to write
\begin{align*}
E[y \xi^T]&=\exp(At)y(0)E[\xi(t)^T]+\int_0^t\exp(A(t-s))BE[\xi(t)^T]ds+\int_0^t\exp(A(t-s))QE[\xi(s)\xi(t)]ds
\\&=0+0+\frac{1}{2}Q
\\ \Rightarrow \dot{\Sigma} &= A\Sigma_t+\Sigma_tA^T+vE[y(t)^T]+E[y(t)]v^T+\frac{1}{2}QQ^T+\frac{1}{2}QQ^T
\\ &= A\Sigma_t+\Sigma_tA^T+vE[y(t)^T]+E[y(t)]v^T+QQ^T
\\ \Rightarrow \lim_{t\to\infty} \dot{\Sigma}&=A\Sigma+\Sigma A^T-vv^T(A^{-1})^T-A^{-1}vv^T+QQ^T
\\ \Rightarrow A\Sigma+\Sigma A^T&=vv^T(A^{-1})^T+A^{-1}vv^T-QQ^T \text{ since $\dot{\Sigma}=0$ at equilibrium}.
\end{align*}

Further, by definition of $C$, 
\begin{align*}
C&=\Sigma-\lim_{t\to\infty}E[y(t)]E[y(t)^T]
\\&=\Sigma-(-A^{-1}v)(-A^{-1}v)^T
\\&=\Sigma-A^{-1}vv^T(A^{-1})^T
\\\Rightarrow AC+CA^T&=A\Sigma+\Sigma A^T-AA^{-1}vv^T(A^{-1})^T
-A^{-1}vv^T(A^{-1})^TA^T
\\&=A\Sigma+\Sigma A^T-vv^T(A^{-1})^T-A^{-1}vv^T
\\&=-QQ^T.
\end{align*}
\end{pf}

\begin{fact}
If $V=\sum_iv_i/N$ and $C=\left(E[(v_i-V)(v_j-V)]\right)_{ij}$, then $\sum_{ij}C_{ij}=0$.
\end{fact}
\begin{pf}
\begin{align*}
\sum_{ij}E[(v_i-V)(v_j-V)]&=\sum_{ij}\left(E[v_iv_j]-E[v_iV]-E[v_jV]+E[VV]\right)
\\&=\sum_{ij}E[v_iv_j]-N\sum_iE[v_iV]-N\sum_jE[v_jV]+N^2E[VV]
\\&=\sum_{ij}E[v_iv_j]-\sum_{ij}E[v_iv_j]-\sum_{ij}E[v_iv_j]+\sum_{ij}E[v_iv_j]
\\&=0
\end{align*}
\end{pf}

In the following sections of the Appendix, transforming an opinion vector $x$ will be useful.  To do so, we define a matrix $Q\in\R^{N-1}\times\R^N$ such that each row of $Q$ is orthogonal to $\vec{1}$ and the rows are pairwise orthogonal. Young et al. show in \cite{Young:2010fk} show that this equivalent to finding $Q$ such that $Q\vec{1}=\vec{0}$, $QQ^T=I_{N-1}$, and $Q^TQ=I_N-\frac{1}{N}\vec{1}_N\vec{1}_N^T$.  We next define a rotation matrix $R\in\R^N\times\R^N$ such that the last row of $R$ is $\frac{1}{\sqrt{N}}\vec{1}^T$ and the other rows are given by the rows of $Q$. Since the rows of $R$ are orthonormal, $RR^T=I$ and $R$ is invertible, which implies that $R^T=R^{-1}$. If $z=Q^TQx$, then $z_i=v_i-\frac{1}{N}\sum_iv_i$. Similarly, if $\bar{y}=Rx$, then $\bar{y}_N=\frac{1}{\sqrt{N}}\sum_ix_i$ and $y=(\bar{y}_1,\dots,\bar{y}_{N-1})^T=Qx$ gives the component of $v$ that is orthogonal to the consensus vector $\vec{1}$. We can also translate between $y$ and $z$ by noting that $z=Q^Ty$ and $y=QQ^Tz$ or $y$ is given by the first $N-1$ coordinates of $Rz$.

\begin{equation} \label{transformations}
 \boxed{V=\frac{1}{N}\sum_ix_i ,\ z=Q^TQx=x-V\vec{1}, \ \bar{y}=Rx,\ y=Qx=\bar{y}_{i=1}^{N-1}}
 \end{equation}
 

\subsection{Opinion dynamics with noise }
In our model, each bird in the flock as an opinion $x_i$, giving an opinion vector $x$. The $\mathscr{H}_2$ robustness of the opinion dynamics is defined by the inverse of the expected distance at equilibrium from the opinion vector to a consensus state in which all birds have the same opinion, i.e. $x_i=\alpha$ for all $i$ and for some $\alpha\in\R$. That is, the dynamics are robust if, at equilibrium, the opinions are close to being in consensus. We can find this distance by rotating the opinion vector into the space orthogonal to the consensus vector, $\vec{1}$.  If $y=Qx$, then $||y||=y^Ty$ describes how far away from consensus $x$ is. Specifically, robustness as in \cite{Young:2010fk} is given by 
\begin{equation}
r=\lim_{t\to\infty}\frac{1}{E[||y||]}=\lim_{t\to\infty}\frac{1}{\Tr E[yy^T]}. \label{H2_robustness}
\end{equation}
We also define a full rotation matrix $R\in\R^N\times\R^N$ such that $R=\left(\begin{array}{cc} Q \\ \frac{1}{\sqrt{N}}\vec{1}^T \end{array}\right)$.

Young et al. \cite{Young:2010fk} model opinion dynamics by assuming that each bird averages the differences between its opinion and each of the opinions of its neighbors and changes its opinion to minimize this difference and that each bird's opinion is subject to independent noise with variance proportional to the number of neighbors each bird has. The equations describing these dynamics can be written as 
\begin{equation}
\dot{x_i}=\frac{\sum_{\text{neighbors $j$ of $i$ } }(x_j-x_i)}{k_i} +\sqrt{k_i}\xi_i=\sum_j\bar{A}_{ij}x_j-x_i+\sqrt{k_i}\xi_i=\sum_jL_{ij}x_j+\sqrt{k_i}\xi_i.
\end{equation}
In vector notation this becomes
\begin{equation}
\dot{x}=Lx+D\xi.
\end{equation}
The equilibrium of these dynamics is a consensus state in which all birds have the some opinion, $x=\alpha\vec{1}$ for some $\alpha\in\R$. In the absence of any environmental signal, the consensus opinion can be any value $\alpha$. In the presence of an environmental signal, some birds in the flock perceive the signal and change their opinions to be closer to $1$. The environmental forcing is described by a diagonal matrix $B$ where $B_{ii}=b$ if $i$ perceives the environmental signal and $B_{ii}=0$ otherwise and the dynamics then become
\begin{equation}
\dot{x}=Lx+B(\vec{1}-x)+D\xi=L_\text{s}x+v+D\xi.
\end{equation}
where $L_\text{s}=L-B$ and $v=B\vec{1}$. If $b=0$, then $L_\text{s}=L$ and $v=\vec{0}$, so the case with the signal reduces to the case without the signal. 


If $\bar{y}=Rx$, then the first $N-1$ coordinates of $\bar{y}$ are $y=Qx$ and the last is $\sum_ix_i/\sqrt{N}$. The dynamics of $\bar{y}$ are described by 
\begin{align*}
\dot{\bar{y}}&=R\dot{x}
\\&=RL_\text{s}x+Rv+RD\xi.
\\&=RL_\text{s}R^T\bar{y}+Rv+RD\xi
\\&=\tilde{L}_\text{s}\bar{y}+\tilde{v}+\tilde{D}\xi 
\end{align*}
where $\tilde{L}_\text{s}=RL_\text{s}R^T$, $\tilde{v}=Rv=RB\vec{1}$, and $\tilde{D}=RD$. If $b\neq 0$, $L_\text{s}$ and therefore $\tilde{L}_\text{s}$ have all negative eigenvalues and $\bar{y}=(0, 0, \dots 0, \sqrt{N})^T$ is a globally asymptotically stable equilibrium. Therefore, by Theorem \ref{lyapeq_theorem} and Claim \ref{lyapeq_derivation}, $\lim_{t\to\infty}E[\bar{y}(t)\bar{y}(t)^T]=\Sigma_{\bar{y}}$ where $\tilde{L}_\text{s}\Sigma_{\bar{y}}+\Sigma_{\bar{y}}\tilde{L}_\text{s}^T=-RD^2R^T$. We can  find $\Sigma_y=\lim_{t\to\infty}E[y(t)y(t)^T]$
by removing the last row and column of $\Sigma_{\bar{y}}$.

If $b=0$, $L$ has a $0$ eigenvalue corresponding to the eigenvector $\vec{1}$. Therefore, $RLR^T$ also has a $0$ eigenvalue, so we can therefore no longer find the desired $\Sigma_{\bar{y}}$.  Since the last row of $R=\frac{1}{\sqrt{N}}\vec{1}$, all entries of the the last column of $LR^T$ are $0$. Therefore, all entries of the last column of $RLR^T$ are $0$. In other words, the dynamics of the first $N-1$ elements of $\bar{y}$, i.e. $y$, do not depend on the last. This lets us write 
\begin{align*}
\dot{y}&=QLQ^Ty+Q\xi=\bar{L}+Q\xi
\end{align*}
where $\bar{L}=QLQ^T$. Another way to see this is to write 
\begin{align*}
 \dot{y}&=Q\dot{x}
 \\ &=QLx+Q\xi
 \\&=QL(x-\langle x\rangle \vec{1})+Q\xi \text{ since $L\vec{1}=\vec{0}$}
 \\&=QLQ^TQx+Q\xi
 \\&=\bar{L}y+Q\xi.
\end{align*}
Again, by Claim \ref{lyapeq_derivation} and Theorem \ref{lyapeq_theorem}, we can now find $\lim_{t\to\infty}E[y(t)y(t)^T]=\Sigma_y$ by finding a solution to $\bar{L}\Sigma_y+\Sigma_y\bar{L}=-QD^2Q^T$. 

To summarize, in the absence of an environmental signal, $\Sigma_y$ satisfies $\bar{L}\Sigma_y+\Sigma_y\bar{L}^T=-QD^2Q^T$ where $\bar{L}=QLQ^T$ and in the presence of an environmental signal, $\Sigma_y$ can be found in the first $N-1$ rows and columns of $\Sigma_{\bar{y}}$ where $\Sigma_{\bar{y}}$ satisfies $\tilde{L}_\text{s}\Sigma_{\bar{y}}+\Sigma_{\bar{y}}\tilde{L}_\text{s}^T=-RD^2R^T$ where $\tilde{L}_\text{s}=RL_\text{s}R^T$.


\subsection{Probability distribution at equilibrium }
%Specifically, an individual's opinion $\sigma_i$ can be either $1$ or $-1$ and $\sigma_i$ switches with probability $w_i(\sigma_i)=\frac{1}{2}(-\sigma_i\sum_jA_{ij}\sigma_j )(1-\beta_i\sigma_i)$ where $A_{ij}$ indicates the strength of the connection from $j$ to $i$ and $\beta_i$ indicates the strength of the environmental stimulus perceived by $i$.  The stochastic dynamics of the opinions can be written down with a master equation \cite{Glauber:1963fk}.  The vector $\vec{v}(t)$ of expected values, $q_i(t)=\langle \sigma_i(t)\rangle$, satisfies the following differential equations: \cite{Glauber:1963fk}
A quite different way of modeling social interactions the method used by Bialek et al. in \cite{Bialek:2012fk}, which is to assume the opinions come to equilibrium and write down an expression for the probability of finding the opinion vector in every state. In statistical physics, a Hamiltonian describes the energy of a given state, $H(v)$, and the Boltzmann distribution describes a probability distribution in which the most energetic states are least likely. Analogously, we can write a function $H(v)$ that gives a high energy when the opinions are not in consensus and a low energy when the opinions are in consensus and a probability distribution of opinion vectors that favors less energetic states. In order to do this, we must use a symmetric interaction matrix, rather than the possibly asymmetric $\bar{A}$ we used above. Bialek et al. study a model in which opinions are a three-dimensional velocity vector and the birds can weight the opinions of their nearest neighbors with any value $J$. In order to simplify this model and make it directly comparable to the opinion dynamics model we described above, we only consider a scalar-valued opinion $x_i$ and we impose the condition that the weights given to the neighbors' opinions are inversely proportional to the number of neighbors. In particular, we define $S=\frac{1}{2}(A+A^T)$ and $P$ such that $P_{ij}=S_{ij}$ for $j\neq i$ and $P_{ii}=-\sum_kS_{ik}$. This allows us to write down a Hamiltonian
\begin{equation}
H(v)=-v^TPv
\end{equation}
where the negative sign makes opinions far from consensus give high energies and conversely. The probability distribution over opinion vectors $v$ then becomes 
\begin{equation}
P(v)=\frac{1}{Z}\exp\left(-\frac{1}{2}v^T(-P)v\right),
\end{equation}
where $Z=\int_\R^N\exp\left(-\frac{1}{2}H(v)\right)dv$. We can now use this probability distribution to find the  covariances and correlations between the birds' fluctuations around consensus.  If we let $V=\sum_iv_i/N=\langle v\rangle$ and $z=v-V\vec{1}$, $z$ represents the deviations in each bird's opinion from the consensus opinion. We are interested in finding $C_z=\left(E[z_iz_j]\right)_{ij}$. To do this, we first find the probability distribution over $(z,V)$: 
\begin{align*}
P(z,V)&=\frac{1}{Z}\exp\left(-\frac{1}{2}(z+V\vec{1})^T(-P)(z+V\vec{1})\right)
\\&=\frac{1}{Z}\exp\left(-\frac{1}{2}z^T(-P)z\right) \text{ since }P\vec{1}=P^T\vec{1}=\vec{0}.
\end{align*}
Since $P$ has a $0$ eigenvalue, it is not invertible. However, $z$ is orthogonal to the eigenvector of $P$ with eigenvalue $0$. Therefore, the covariance of $z$ is $C_z=-P^\dagger$.
%If $P$ were invertible, the covariance matrix would be given by $-P^{-1}$. However, since $P\vec{1}=\vec{0}$, one of the eigenvalues of $P$ is $0$ and it is therefore not invertible.
%To proceed, we will write $z$ as a linear combination of eigenvectors of $P$. Since $P$ is symmetric and negative, there is an orthonormal set of eigenvectors $\{w_k\}$ such that $Pw_k=\lambda_kw_k$ with $w_N=\vec{1}$ and $\lambda_N=0$. If we let $W$ be a matrix whose columns are given by $\{w_k\}$ and $\Lambda$ be the diagonal matrix with $\{\lambda_k\}$ along the diagonal, then $W^T=W^{-1}$ and $P=W\Lambda W^T$ since $P$ is symmetric. If we write $z=\sum_kc_kw_k=W{c}$, then $c_N=0$ since $\sum_iz_i=0$. If we then denote the $N$ by $N-1$ matrix whose columns are given by $w_1,...w_{N-1}$ as $\tilde{W}$ and the diagonal matrix with $\lambda_1,\dots,\lambda_{N-1}$ along the diagonal as $\tilde{\Lambda}$, then $z=\tilde{W}\tilde{c}$ for a $\tilde{c}\in\R^{N-1}$ and
%%and $\tilde{P}=\tilde{W}\tilde{\Lambda}\tilde{W}^T$, then 
%\begin{align*}
%P(z)&=\frac{1}{Z}\exp\left(-\frac{1}{2}z^T(-{P})z\right)
%\\\Rightarrow P(\tilde{c})&=\frac{1}{Z}\exp\left(-\frac{1}{2}\tilde{c}^T\tilde{W}^T(-W\Lambda W^T)\tilde{W}\tilde{c}\right)
%\\&=\frac{1}{Z}\exp\left(-\frac{1}{2}c^T\tilde{W}^T(-\tilde{W}\tilde{\Lambda}\tilde{W}^T)\tilde{W}c\right) 
%\\&=\frac{1}{Z}\exp\left(-\frac{1}{2}\tilde{c}^T(-\tilde{\Lambda})\tilde{c}\right)  
%\end{align*}
%Therefore, $E[\langle c \rangle ]=\vec{0}$ and $E[\tilde{c}\tilde{c}^T]=(-\tilde{\Lambda})^{-1}$. Therefore, $C_z=E[zz^T]=E[\tilde{W}\tilde{c}\tilde{c}^T\tilde{W}^T]=-\tilde{W}\tilde{\Lambda}^{-1}\tilde{W}^T=-P^\dagger$.  
By dividing each entry $C_{zij}$ of the covariance matrix by $C_{zii}C_{zjj}$, the covariance matrix can be used to find the correlation matrix.

The Hamiltonian framework, like the opinion dynamics framework, can also accommodate an environmental signal. In this case, the appropriate Hamiltonian is 
\begin{equation}
\begin{array}{lll}
H(v)&=-(v-\vec{1})^TP_\text{s}(v-\vec{1})
\end{array}
\end{equation}
where $P_\text{s}=P-B$.
It is clear that $H$ is minimized when $v=\vec{1}$. 
Again, we are interested in the deviations from the consensus opinion. As above, let $V=\sum_iv_i/N$ and $z=v-V\vec{1}$ so that $v=z+V\vec{1}$. 
\begin{align*}
P(v)&=\frac{1}{Z}\exp\left(-\frac{1}{2}(v-\vec{1})^T(-P_\text{s})(v-\vec{1}\right)
\\&=\frac{1}{Z}\exp\left(-\frac{1}{2}(z-(1-V)\vec{1})^T(-P_\text{s})(z-(1-V)\vec{1}\right)
\end{align*}
Since the subspace of $z\in\R^N$ such that $\sum_iz_i=0$ is $N-1$ dimensional, it will be easier to rotate $z$ into $\R^{N-1}$ and integrate over all of $\R^{N-1}$.  Therefore, we define $y=Rz=RQ^TQv=Qv$. Since $\sum_iz_i=0$, $y_N=0$ so $V$ describes the mean of $v$ and $y$ describes the $N-1$ dimensional space of deviations from the consensus opinion. 
\begin{align*}
P(v)&=\frac{1}{Z}\exp\left(-\frac{1}{2}(R^Ty-(1-V)\sqrt{N}R^Te_N)^T(-P_\text{s})(R^Ty-(1-V)\sqrt{N}R^Te_N)\right)
\\&=\frac{1}{Z}\exp\left(-\frac{1}{2}(y-(1-V)\sqrt{N}e_N)^T(-RP_\text{s}R^T)(y-(1-V)\sqrt{N}e_N)\right)
\\&=\frac{1}{Z}\exp\left(-\frac{1}{2}(y+\sqrt{N}Ve_N-\sqrt{N}e_N)^T\Tilde{P}_\text{s}(y+\sqrt{N}Ve_N-\sqrt{N}e_N)\right)
\end{align*}
where $\Tilde{P}_\text{s}=-RP_\text{s}R^T$. To find $P(z)$ we can integrate out $V$. However, to consider this as a probability density function over $y$ and $V$, we have to consider the determinant of the transformation from $v$ to $y$ and $V$.  The  transformation can be represented by $\bar{R}=\left(\begin{array}{cc}Q \\1/\sqrt{N}R_{N\cdot }\end{array}\right)$, so that $\det(\bar{R})=\frac{1}{\sqrt{N}}\det(R)=\frac{1}{\sqrt{N}}$. Therefore, $P(y,V)=\sqrt{N}P(v)$ is the appropriate density function for $y$ and $V$. Finally, note that $Z=\sqrt{(2\pi)^N\det(-P_\text{s}^{-1})}$. This gives

\begin{align*}
P(y,V)&=\sqrt{N}P(v)
\\&=\frac{\sqrt{N}}{Z}\exp\left(-\frac{1}{2}((V-1)\sqrt{N}e_N+y)^T\Tilde{P}_\text{s}((V-1)\sqrt{N}e_N+y)\right)
\\ \Rightarrow P(y)&=\int_\R P(y,V)dV
\\&=\int_\R \frac{\sqrt{N}}{Z}\exp\left(-\frac{1}{2}((V-1)\sqrt{N}e_N+y)^T\Tilde{P}_\text{s}((V-1)\sqrt{N}e_N+y)\right)dV
\\&=\frac{\sqrt{N}}{Z}\exp\left(-\frac{1}{2}y^T\Tilde{P}_\text{s}y\right)\int_\R \exp\left(-\frac{1}{2}\left(\Tilde{P}_{\text{s}NN}N\left(V-1\right)^2+(V-1)\sqrt{N}\tilde{P}_{\text{s}N\cdot}y+(V-1)\sqrt{N}y^T\tilde{P}_{\text{s}\cdot N}\right)\right)dV
\\&=\frac{\sqrt{N}}{Z}\exp\left(-\frac{1}{2}y^T\Tilde{P}_\text{s}y\right)\int_\R \exp\left(-\frac{1}{2}\left(\Tilde{P}_{\text{s}NN}N\left(V-1\right)^2+2(V-1)\sqrt{N}\tilde{P}_{\text{s}N\cdot}y\right)\right)dV \text{ since $\Tilde{P}_\text{s}$ is symmetric }
\\&=\frac{\sqrt{N}}{Z}\exp\left(-\frac{1}{2}\left(y^T\Tilde{P}_\text{s}y-\left(\frac{\tilde{P}_{\text{s}N\cdot}y}{\sqrt{\tilde{P}_\text{s}NN}}\right)^2\right)\right)\times
\\&\int_\R \exp\left(-\frac{1}{2}\left(\Tilde{P}_{\text{s}NN}N\left(V-1\right)^2+2(V-1)\sqrt{N}\tilde{P}_{\text{s}N\cdot}y+\left(\frac{\tilde{P}_{\text{s}N\cdot}y}{\sqrt{\Tilde{P}_{\text{s}NN}}}\right)^2\right)\right)dV 
\\&=\frac{\sqrt{N}}{Z}\exp\left(-\frac{1}{2}\left(y^T\left(\tilde{P}_{\text{s}}-\frac{1}{\tilde{P}_{\text{s}NN}}\tilde{P}_{\text{s}\cdot N}\tilde{P}_{\text{s}N\cdot}\right)y\right)\right)\int_\R \exp\left(-\frac{1}{2}\left(\sqrt{\Tilde{P}_{\text{s}NN}N}\left(V-1\right)+\frac{\tilde{P}_{\text{s}N\cdot}y}{\sqrt{\Tilde{P}_{\text{s}NN}}}\right)^2\right)dV
\\&=\frac{\sqrt{N}}{Z}\exp\left(-\frac{1}{2}\left(y^T(\tilde{P}_{\text{s}}-\frac{1}{\tilde{P}_{\text{s}NN}}\tilde{P}_{\text{s}\cdot N}\tilde{P}_{\text{s}N\cdot})y\right)\right)\int_\R \exp\left(-\frac{1}{2}\tilde{P}_{\text{s}NN}N\left(V-1+\frac{\sum_i\tilde{P}_{\text{s}Ni}y_i}{\tilde{P}_{\text{s}NN}\sqrt{N}}\right)^2\right)dV
\\&=\frac{\sqrt{N}}{Z}\exp\left(-\frac{1}{2}\left(y^T(\tilde{P}_{\text{s}}-\frac{1}{\tilde{P}_{\text{s}NN}}\tilde{P}_{\text{s}\cdot N}\tilde{P}_{\text{s}N\cdot})y\right)\right)\times\sqrt{\frac{2\pi}{\tilde{P}_{\text{s}NN}N}}
\\&=\frac{1}{\sqrt{(2\pi)^{N-1}\det(-P_\text{s}^{-1})\tilde{P}_{\text{s}NN}}}\exp\left(-\frac{1}{2}\left(y^T(\tilde{P}_{\text{s}}-\frac{1}{\tilde{P}_{\text{s}NN}}\tilde{P}_{\text{s}\cdot N}\tilde{P}_{\text{s}N\cdot })y\right)\right)
\end{align*}


Therefore, $E[y_i]=0$ for all $i$ and $E[yy^T]=(\tilde{P}_{\text{s}}-\frac{1}{\tilde{P}_{\text{s}NN}}\tilde{P}_{\text{s}\cdot N}\tilde{P}_{\text{s}N\cdot })^{-1}$. Then, 
\begin{equation*}
E[zz^T]=R^T\left(\tilde{P}_{\text{s}}-\frac{1}{\tilde{P}_{\text{s}NN}}\tilde{P}_{\text{s}\cdot N}\tilde{P}_{\text{s}N\cdot }\right)^{-1}R=\left(-P_\text{s}-\frac{1}{\tilde{P}_{\text{s}NN}N}B\vec{1}\vec{1}^TB\right)^{-1}
\end{equation*}
Let $N_\text{I}$ be the number of birds that can perceive the signal, i.e. $N_\text{I}$ is the number of non-zero elements along the diagonal of $B$. Then, $\tilde{P}_{\text{s}NN}=\frac{b}{N}N_\text{I}$. 
Finally, we find that 
\begin{equation}
C_z=\left(-P_\text{s}-\frac{1}{bN_\text{I}}B\vec{1}\vec{1}^TB\right)^{-1}
\end{equation}
If $P'=P_\text{s}+\frac{1}{bN_\text{I}}B\vec{1}\vec{1}^TB$, then $P'\vec{1}=-B\vec{1}-\frac{1}{bN_\text{I}}B\vec{1}\vec{1}^TB\vec{1}=-B\vec{1}-\frac{bN_\text{I}}{bN_\text{I}}B\vec{1}=\vec{0}$, so we cannot invert $-P'$ to find the covariance matrix. However, as above, we can discard the $0$ eigenvector since we know that $z\cdot \vec{1}=0$. This gives us $C_z=(-P_\text{s}-\frac{1}{bN_\text{I}}B\vec{1}\vec{1}^TB)^{\dagger}$.

\subsection{Connecting two frameworks }
Table \ref{correspondence} shows how to find the covariance of $y$ depending on the framework being used and whether or not a signal is present. 

\begin{claim}\label{cov_equivalence}If we use $P$ instead of $L$ with the noisy dynamics framework and all birds have the same number of neighbors $n$, then $C_y=\frac{2}{n}\Sigma_y$.
\end{claim}
\begin{pf}
If we use $P$ in the noisy dynamics framework, $\Sigma_y$ satisfies
\begin{equation}
QPQ^T\Sigma_y+\Sigma_y QP^TQ^T=-QD^2Q^T.
\end{equation}
If all birds have $n$ neighbors, then $D^2$ has $n$ along the diagonal and $0$ elsewhere and $-QD^2Q^T=-nI_{N-1}$.  Now consider
\begin{align*}
QPQ^TC_y+C_yQP^TQ^T&=QPQ^T(-QP^\dagger Q^T)+(-QP^\dagger Q^T)QP^T
\\&=-QP(I_N-\frac{1}{N}\vec{1}\vec{1}^T)P^\dagger Q^T-QP^\dagger (I_N-\frac{1}{N}\vec{1}\vec{1}^T)P^T
\\&=-QPP^\dagger Q^T-QP^\dagger P^TQ^T \text{ since $P\vec{1}=\vec{0}$ }
\\&=-Q(I_N-\frac{1}{N}\vec{1}\vec{1}^T)Q^T-Q(I_N-\frac{1}{N}\vec{1}\vec{1}^T)Q^T
\\&=-QQ^T-QQ^T \text{ since $Q\vec{1}=\vec{0}$}
\\&=-2I_{N-1}
\\ \Rightarrow QPQ^T\left(\frac{n}{2}C_y\right)+\left(\frac{n}{2}C_y\right)QP^TQ^T&=-nI_{N-1}
\\ \Rightarrow\frac{n}{2}C_y&=\Sigma_y
\end{align*}
since there is a unique solution to this Lyapunov equation.
\end{pf}

A similar proof shows the equivalence of the two covariance matrices in the presence of a signal, as long as $P_\text{s}$ is used in the noisy dynamical system and all birds have the same number of neighbors.
%
%We can also make a connection between the two frameworks by considering the dynamics that minimize the Hamiltonian that gives rise to the Boltzmann distribution. 
%If the vector $v$ is described by the dynamics $\dot{v}=Wv$, with $H(v)=-v^TPv$, then
%\begin{align*}
%\dot{H}&=-\dot{v}^TPv-v^TP\dot{v}
%\\&=-v^TW^TPv-v^TPWv
%\\&=-v^T(W^TP+PW)v.
%\end{align*}
%Therefore, $H(v)$ decreases at all $v$ if and only if $D^TP+PD$ is a positive matrix.
%


\begin{table}
\caption{\label{correspondence} $P^\dagger$ is the inverse of $P$ with the $0$ eigenvector / value removed. }
\ra{1.3}
\begin{tabular}{@{}l|llll@{}}
& Without signal & With signal 
\\\hline From noisy dynamics &  $\bar{L}\Sigma_y+\Sigma_y\bar{L}^T=-QD^2Q^T$ & $\tilde{L}_\text{s}\Sigma_{\bar{y}}+\Sigma_{\bar{y}}\tilde{L}_\text{s}^T=-RD^2R^T$, $\Sigma_y=(\Sigma_{\bar{y}})_{i,j=1}^{N-1}$
\\\hline From Boltzmann equilibrium & $C_y=-QP^{\dagger}Q^T$ & $C_y=(\tilde{P}_\text{s}-\frac{1}{\tilde{P}_{\text{s}NN}}\tilde{P}_{\text{s}\cdot N}\tilde{P}_{\text{s}N\cdot })^\dagger$
\\ & & or $C_y=Q(-P_\text{s}-\frac{1}{bN_\text{I}}B\vec{1}\vec{1}^TB)^{\dagger}Q^T$
\end{tabular}
\end{table}




\begin{table}
\caption{ \label{matrices} Table of matrices and variables used in the text.}
\ra{1.3}
\begin{tabular}{@{}lllll@{}}
$A$ & adjacency matrix & $A_{ij}=\left\{\begin{array}{l l l}
1 & \text{ if $i$ pays attention to $j$ }
\\0 & \text{ otherwise }
\end{array}\right.$
\\$\bar{A}$ & normalized adjacency matrix & $\bar{A}_{ij}=\left\{\begin{array}{l l l }
\frac{1}{k_i} & \text{ if $i$ pays attention to $j$, where $k_i=$ \# of birds $i$ pays attention to}
\\ 0 & \text{ otherwise }
\end{array}\right. $
\\$B$ & diagonal signal matrix & $B_{ij}=\left\{\begin{array}{l l l}
b & \text{ if $i=j$ and $i$ perceives the environmental signal }
\\0 & \text{ otherwise }
\end{array}\right. $
\\ $\lambda$ & correlation length
\\ $\Lambda$ & diagonal matrix of eigenvalues of $P$
\\$L$ & opinion dynamics w/o environmental signal &$L=\bar{A}-I$
\\$L_\text{s}$ & opinion dynamics with environmental signal & $L_\text{s}=L-B$
\\$\bar{L}$ & dynamics of deviations from consensus w/o signal & $\bar{L}=QLQ^T$
\\$\tilde{L}_\text{s}$ & dynamics of deviations from consensus w/ signal & $\tilde{L}=RL_\text{s}R^T$
\\$S$ & symmetrized interaction matrix & $S=\frac{1}{2}(\bar{A}+\bar{A}^T)$
\\$P$ & energy interactions w/o environmental signal & $P_{ij}=\left\{\begin{array}{lll}
S_{ij} & \text{ for } j\neq i
\\-\sum_kS_{ik} & \text{ for } j=i
\end{array}\right.
$
\\$P_\text{s}$ & energy interactions with environmental signal &  $P_\text{s}=P-B$
\\$\tilde{P}_\text{s}$
\\$Q$ & rotates opinion vector away from consensus & $Q\in \R^{N-1}\times\R^N \text{ such that } Q\vec{1}=\vec{0}, \ QQ^T=I_{N-1}, \text{ and } Q^TQ=I_N-\frac{1}{N}\vec{1}_N\vec{1}_N^T $
\\$R$ & full rotation matrix whose last row is $\frac{1}{\sqrt{N}}\vec{1}^T$ & $\left(\begin{array}{cc} Q \\ \frac{1}{\sqrt{N}}\vec{1}^T \end{array}\right)$
\\$\rho$ & $\mathscr{H}_2$ robustness & $\lim_{t\to\infty}\frac{1}{E[||y||]}$ where $y=Qx$
\\$W$ & matrix of eigenvectors of $P$
\end{tabular}
\end{table}

\newpage
\section{Figures }
\begin{figure}
\includegraphics[width=6.83in]{/Users/eleanorbrush/Desktop/H2_and_corrlength.pdf}
\caption{\label{compare_props}  Both $\mathscr{H}_2$ and correlation length are maximized at intermediate strategies when there are few informed birds and at low strategies when there are many informed birds. In (a), we show the average $\mathscr{H}_2$ robustness over $1000$ signaling events, where all birds use the same strategy and the signal is available to all birds within a circle of a given radius.  In (b), we show the average correlation length over $1000$ signaling events, where all birds use the same strategy and the signal is available to all birds within a circle of a given radius. }
\end{figure}

\begin{figure}
\includegraphics[width=6.83in]{/Users/eleanorbrush/Desktop/ESSfigure.pdf}
\caption{\label{ESS} The ESS number of neighbors is always higher if selection is due to predation than due to resources or to both. When selection is due to predation, the (possibly multiple) ESS strategies increase with the radius of the signal. In (a), we show the relative fitness of an invader as a function of the invader and resident strategies when the radius $r=0.1$, where fitness depends on escaping predation. The circles indicate the ESS strategies, i.e. those resident strategies such that no invader has a higher fitness than the resident. In (b), we show the (possibly multiple) ESS strategies as a function of the radius of the signal. The circles show the ESS when selection is due to predation, the squares when selection is due to access to scarce resources, and the diamonds when selection is due to both. The diamonds and squares overlap. There are no ESS when selection is due to access to abundant resources.  Parameters:  in both panels $N=20$, $b=1$, $T=1$. 
}
\end{figure}

%\begin{figure}
%\includegraphics[width=6.83in]{/Users/eleanorbrush/Desktop/robustness_vs_ESS.pdf}
%\caption{\label{ESS_v_H2}
%%The correlation length of a homogeneous flock depends on both the strategy being used and the radius of the signal, but it depends much more strongly on the radius than the strategy. The ESS number of neighbors is an increasing function of correlation length of a homogeneous group. In (a), we show the average correlation length of a homogeneous flock as a function of the strategy being used and the radius of the signal. In (b), each point corresponds to a value of the radius of signal: the horizontal axis shows the correlation length of a flock paying attention to $N/2$ neighbors for that radius and the vertical axis shows the ESS number of neighbors for that radius. Parameters: $N=20$, $\beta=1$, $T=1$.
%}
%\end{figure}

\begin{figure}
\includegraphics[width=4in]{/Users/eleanorbrush/Desktop/greedyoptneighbors_radius=1.pdf}
\caption{\label{greedyopt} When the birds perform greedy optimization and change their number of neighbors to improve their own fitness, they settle on strategies close to the ESS strategies for that selection regimes. When selection is due to predation, they settle on high strategies; when selection is due to access to few resources or to both resources and predation, they settle on low strategies; when selection is due to access to abundant resources, they settle in intermediate strategies. Only under selection due to generous access to resources does this optimization lead to an increase in both $\mathscr{H}_2$ robustness and correlation length. The upper row shows results from selection based to predation, the second row shows results from selection based on access to scarce resources, the third row shows results from selection based on both resources and predation, and the last row shows results from selection based on generous to abundant resources. In each panel, the  horizontal axis represents the number of times the birds are allowed to choose optimal strategies. The first column shows one example of how the birds' strategies change over time. The second column shows, for various initial conditions, how the $\mathscr{H}_2$ robustness changes over time, with the black line showing the average of the $20$ gray lines. The third column shows, for various initial conditions, how the correlation length changes over time, with the black line shows the average of the $20$ gray lines. Parameters:  $N=20$, $b=1$, $r=.1$, $T=1$. 
}
\end{figure}

\begin{figure}
\includegraphics[width=6.83in]{/Users/eleanorbrush/Desktop/hypergeometric.pdf}
\caption{\label{hypergeo} If a fixed number of birds are informed and birds choose neighbors randomly without regard to spatial proximity, the probability of having any number of informed neighbors follows the hypergeometric distribution. A bird with more neighbors is less likely to have a low proportion of informed neighbors, but is also less likely to have a high proportion of informed neighbors. In (a), we show the hypergeometric distribution, giving the probability of having a number of informed neighbors, normalized by the total number of neighbors, for two strategies, $15$ in blue and $5$ in red. In (b), we consider a group made up of $19$ birds using strategy $15$ and $1$ using strategy $5$. For each bird, we draw a number of informed neighbors from the hypergeometric distribution  $1000$ times and rank the birds according to the proportion of their neighbors that are informed. We show the frequency with which the bird using $5$ neighbors and one of the birds using $15$ neighbors is ranked $1^\text{st}$ through $6^\text{th}$. The bird with $5$ neighbors is ranked $1^\text{st}$ much more often, but is also ranked $6^\text{th}$ more often. Parameters: $N=20$. }
\end{figure}




%\nocite{*}
\bibliographystyle{plain}
\bibliography{info_evo}

\end{document}


